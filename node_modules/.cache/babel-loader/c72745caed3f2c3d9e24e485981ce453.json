{"ast":null,"code":"import _asyncToGenerator from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/regenerator/index.js\";import{createSlice}from\"@reduxjs/toolkit\";import storage from\"../firebase\";import{ref,uploadBytes,getDownloadURL}from\"firebase/storage\";import{v4 as uuid}from'uuid';var initialState={filterYear:\"2022\",filtercategory:\"all\",userID:\"\",expences:[]};var ExpencesSlice=createSlice({name:\"Expences\",initialState:initialState,reducers:{updateExpence:function updateExpence(state,action){// debugger\nstate.expences=[].concat(_toConsumableArray(state.expences),_toConsumableArray(action.payload));},filter:function filter(state,action){state.filterYear=action.payload.year;state.filtercategory=action.payload.category;},addUserId:function addUserId(state,action){state.userID=action.payload;localStorage.setItem(\"userId\",state.userID);}}});export var AddExpence=function AddExpence(expence){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,getState){var userId,add_expence,res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:userId=getState().expences.userID;add_expence=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var file,storageRef,expenceRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:file=expence.bill;storageRef=ref(storage,uuid());_context.next=4;return uploadBytes(storageRef,file).then(function(response){debugger;return getDownloadURL(ref(storage,response.metadata.fullPath)).then(function(url){return url;});}).then(function(url){expence['billURL']=url;});case 4:_context.next=6;return fetch(\"https://expencetracker-b3897-default-rtdb.firebaseio.com/users/\".concat(userId,\".json\"),{method:\"post\",body:JSON.stringify(expence),headers:{\"Content-Type\":\"Application/Json\"}});case 6:expenceRes=_context.sent;if(!expenceRes.ok){_context.next=11;break;}return _context.abrupt(\"return\",expenceRes.json());case 11:throw new Error(\"not able to add new expence\");case 12:case\"end\":return _context.stop();}}},_callee);}));return function add_expence(){return _ref2.apply(this,arguments);};}();if(userId){try{res=add_expence();res.then(function(data){expence[\"id\"]=data[\"name\"];dispatch(ExpencesAction.updateExpence([expence]));});}catch(error){alert(error);}}case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();};export var ExpencesAction=ExpencesSlice.actions;export default ExpencesSlice.reducer;","map":{"version":3,"sources":["/home/yta-odoo/Documents/expence-tracker/src/store/expences-slice.js"],"names":["createSlice","storage","ref","uploadBytes","getDownloadURL","v4","uuid","initialState","filterYear","filtercategory","userID","expences","ExpencesSlice","name","reducers","updateExpence","state","action","payload","filter","year","category","addUserId","localStorage","setItem","AddExpence","expence","dispatch","getState","userId","add_expence","file","bill","storageRef","then","response","metadata","fullPath","url","fetch","method","body","JSON","stringify","headers","expenceRes","ok","json","Error","res","data","ExpencesAction","error","alert","actions","reducer"],"mappings":"qYAAA,OAASA,WAAT,KAA4B,kBAA5B,CACA,MAAOC,CAAAA,OAAP,KAAoB,aAApB,CACA,OAASC,GAAT,CAAcC,WAAd,CAA2BC,cAA3B,KAAiD,kBAAjD,CACA,OAASC,EAAE,GAAIC,CAAAA,IAAf,KAA2B,MAA3B,CAEA,GAAMC,CAAAA,YAAY,CAAG,CACnBC,UAAU,CAAE,MADO,CAEnBC,cAAc,CAAE,KAFG,CAGnBC,MAAM,CAAE,EAHW,CAInBC,QAAQ,CAAE,EAJS,CAArB,CAMA,GAAMC,CAAAA,aAAa,CAAGZ,WAAW,CAAC,CAChCa,IAAI,CAAE,UAD0B,CAEhCN,YAAY,CAAZA,YAFgC,CAGhCO,QAAQ,CAAE,CACRC,aADQ,wBACMC,KADN,CACaC,MADb,CACqB,CAC3B;AACAD,KAAK,CAACL,QAAN,8BAAqBK,KAAK,CAACL,QAA3B,qBAAwCM,MAAM,CAACC,OAA/C,GACD,CAJO,CAKRC,MALQ,iBAKDH,KALC,CAKMC,MALN,CAKc,CACpBD,KAAK,CAACR,UAAN,CAAmBS,MAAM,CAACC,OAAP,CAAeE,IAAlC,CACAJ,KAAK,CAACP,cAAN,CAAuBQ,MAAM,CAACC,OAAP,CAAeG,QAAtC,CACD,CARO,CASRC,SATQ,oBASEN,KATF,CASSC,MATT,CASiB,CACvBD,KAAK,CAACN,MAAN,CAAeO,MAAM,CAACC,OAAtB,CACAK,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+BR,KAAK,CAACN,MAArC,EACD,CAZO,CAHsB,CAAD,CAAjC,CAmBA,MAAO,IAAMe,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,OAAD,CAAa,CACrC,+FAAO,kBAAOC,QAAP,CAAiBC,QAAjB,iJACDC,MADC,CACQD,QAAQ,GAAGjB,QAAX,CAAoBD,MAD5B,CAECoB,WAFD,2FAEe,kKACZC,IADY,CACLL,OAAO,CAACM,IADH,CAEZC,UAFY,CAEC/B,GAAG,CAACD,OAAD,CAAUK,IAAI,EAAd,CAFJ,uBAGZH,CAAAA,WAAW,CAAC8B,UAAD,CAAaF,IAAb,CAAX,CAA8BG,IAA9B,CAAmC,SAACC,QAAD,CAAc,CACrD,SACA,MAAO/B,CAAAA,cAAc,CAACF,GAAG,CAACD,OAAD,CAAUkC,QAAQ,CAACC,QAAT,CAAkBC,QAA5B,CAAJ,CAAd,CAAyDH,IAAzD,CACL,SAACI,GAAD,CAAS,CACP,MAAOA,CAAAA,GAAP,CACD,CAHI,CAAP,CAKD,CAPK,EAOHJ,IAPG,CAOG,SAACI,GAAD,CAAS,CAChBZ,OAAO,CAAC,SAAD,CAAP,CAAqBY,GAArB,CACD,CATK,CAHY,8BAcOC,CAAAA,KAAK,0EACsCV,MADtC,UAE5B,CACEW,MAAM,CAAE,MADV,CAEEC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAejB,OAAf,CAFR,CAGEkB,OAAO,CAAE,CACP,eAAgB,kBADT,CAHX,CAF4B,CAdZ,QAcZC,UAdY,mBAyBdA,UAAU,CAACC,EAzBG,0DA0BTD,UAAU,CAACE,IAAX,EA1BS,eA4BV,IAAIC,CAAAA,KAAJ,CAAU,6BAAV,CA5BU,wDAFf,kBAEClB,CAAAA,WAFD,4CAkCL,GAAID,MAAJ,CAAY,CACV,GAAI,CACIoB,GADJ,CACUnB,WAAW,EADrB,CAEFmB,GAAG,CAACf,IAAJ,CAAS,SAACgB,IAAD,CAAU,CACjBxB,OAAO,CAAC,IAAD,CAAP,CAAgBwB,IAAI,CAAC,MAAD,CAApB,CACAvB,QAAQ,CAACwB,cAAc,CAACpC,aAAf,CAA6B,CAACW,OAAD,CAA7B,CAAD,CAAR,CACD,CAHD,EAID,CAAC,MAAO0B,KAAP,CAAc,CACdC,KAAK,CAACD,KAAD,CAAL,CACD,CACF,CA5CI,wDAAP,mEA8CD,CA/CM,CAiDP,MAAO,IAAMD,CAAAA,cAAc,CAAGvC,aAAa,CAAC0C,OAArC,CACP,cAAe1C,CAAAA,aAAa,CAAC2C,OAA7B","sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport storage from \"../firebase\";\nimport { ref, uploadBytes, getDownloadURL } from \"firebase/storage\";\nimport { v4 as uuid } from 'uuid';\n\nconst initialState = {\n  filterYear: \"2022\",\n  filtercategory: \"all\",\n  userID: \"\",\n  expences: [],\n};\nconst ExpencesSlice = createSlice({\n  name: \"Expences\",\n  initialState,\n  reducers: {\n    updateExpence(state, action) {\n      // debugger\n      state.expences = [...state.expences, ...action.payload];\n    },\n    filter(state, action) {\n      state.filterYear = action.payload.year;\n      state.filtercategory = action.payload.category;\n    },\n    addUserId(state, action) {\n      state.userID = action.payload;\n      localStorage.setItem(\"userId\", state.userID);\n    },\n  },\n});\n\nexport const AddExpence = (expence) => {\n  return async (dispatch, getState) => {\n    let userId = getState().expences.userID;\n    const add_expence = async () => {\n      const file = expence.bill;\n      const storageRef = ref(storage, uuid());\n      await uploadBytes(storageRef, file).then((response) => {\n        debugger;\n        return getDownloadURL(ref(storage, response.metadata.fullPath)).then(\n          (url) => {\n            return url;\n          }\n        );\n      }).then ((url) => {\n        expence['billURL'] = url;\n      });\n\n      const expenceRes = await fetch(\n        `https://expencetracker-b3897-default-rtdb.firebaseio.com/users/${userId}.json`,\n        {\n          method: \"post\",\n          body: JSON.stringify(expence),\n          headers: {\n            \"Content-Type\": \"Application/Json\",\n          },\n        }\n      );\n\n      if (expenceRes.ok) {\n        return expenceRes.json();\n      } else {\n        throw new Error(\"not able to add new expence\");\n      }\n    };\n\n    if (userId) {\n      try {\n        const res = add_expence();\n        res.then((data) => {\n          expence[\"id\"] = data[\"name\"];\n          dispatch(ExpencesAction.updateExpence([expence]));\n        });\n      } catch (error) {\n        alert(error);\n      }\n    }\n  };\n};\n\nexport const ExpencesAction = ExpencesSlice.actions;\nexport default ExpencesSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}