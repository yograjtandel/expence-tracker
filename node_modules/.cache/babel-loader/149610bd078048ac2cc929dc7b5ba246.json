{"ast":null,"code":"import _asyncToGenerator from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/yta-odoo/Documents/expence-tracker/node_modules/@babel/runtime/regenerator/index.js\";import{useState,useRef,useContext,useEffect}from\"react\";import{useDispatch}from\"react-redux\";import classes from\"./AuthForm.module.css\";import AuthContext from\"../../store/AuthContext\";import{ExpencesAction}from\"../../store/expences-slice\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AuthForm=function AuthForm(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLogin=_useState2[0],setIsLogin=_useState2[1];var emailRef=useRef();var passwordRef=useRef();var ctx=useContext(AuthContext);var dispatch=useDispatch();useEffect(function(){var uid=localStorage.getItem(\"userId\");if(uid){dispatch(ExpencesAction.addUserId(uid));}},[dispatch]);var switchAuthModeHandler=function switchAuthModeHandler(){setIsLogin(function(prevState){return!prevState;});};var onSubmitHandler=function onSubmitHandler(event){event.preventDefault();var email=emailRef.current.value;var password=passwordRef.current.value;if(email&&password){var url=\"\";if(isLogin){url=\"https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDkyHz1CTqvoZKQHlZqcOmhjNwnAzH2HJo\";}else{url=\"https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDkyHz1CTqvoZKQHlZqcOmhjNwnAzH2HJo\";}fetch(url,{method:\"POST\",body:JSON.stringify({email:email,password:password,returnSecureToken:true}),headers:{\"Content-Type\":\"application/json\"}}).then(function(res){if(res.ok){return res.json();}else{throw new Error(\"auth fail\");}}).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user){var res;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"https://expencetracker-b3897-default-rtdb.firebaseio.com/users.json?orderBy=\\\"email\\\"&equalTo=\\\"\".concat(email,\"\\\"&print=pretty\"));case 2:res=_context3.sent;res.json().then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data){var userId,add_email;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:userId=\"\";add_email=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var userRes;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return fetch(\"https://expencetracker-b3897-default-rtdb.firebaseio.com/users.json\",{method:\"post\",body:JSON.stringify({email:localStorage.getItem(\"email\")}),headers:{\"Content-Type\":\"Application/Json\"}});case 2:userRes=_context.sent;if(!userRes.ok){_context.next=7;break;}return _context.abrupt(\"return\",userRes.json().then(function(user){return user[\"name\"];}));case 7:throw new Error(\"not able to add email\");case 8:case\"end\":return _context.stop();}}},_callee);}));return function add_email(){return _ref3.apply(this,arguments);};}();if(!(Object.keys(data).length===0)){_context2.next=14;break;}_context2.prev=3;_context2.next=6;return add_email();case 6:userId=_context2.sent;_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](3);alert(_context2.t0);case 12:_context2.next=15;break;case 14:userId=Object.keys(data)[0];case 15:dispatch(ExpencesAction.addUserId(userId));ctx.onLogin(email,user.idToken);case 17:case\"end\":return _context2.stop();}}},_callee2,null,[[3,9]]);}));return function(_x2){return _ref2.apply(this,arguments);};}());case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){alert(error);});}};return/*#__PURE__*/_jsxs(\"section\",{className:classes.auth,children:[/*#__PURE__*/_jsx(\"h1\",{children:isLogin?\"Login\":\"Sign Up\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmitHandler,children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.control,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Your Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",ref:emailRef,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.control,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Your Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",ref:passwordRef,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.actions,children:[/*#__PURE__*/_jsx(\"button\",{children:isLogin?\"Login\":\"Create Account\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:classes.toggle,onClick:switchAuthModeHandler,children:isLogin?\"Create new account\":\"Login with existing account\"})]})]})]});};export default AuthForm;","map":{"version":3,"sources":["/home/yta-odoo/Documents/expence-tracker/src/components/Auth/AuthForm.js"],"names":["useState","useRef","useContext","useEffect","useDispatch","classes","AuthContext","ExpencesAction","AuthForm","isLogin","setIsLogin","emailRef","passwordRef","ctx","dispatch","uid","localStorage","getItem","addUserId","switchAuthModeHandler","prevState","onSubmitHandler","event","preventDefault","email","current","value","password","url","fetch","method","body","JSON","stringify","returnSecureToken","headers","then","res","ok","json","Error","user","data","userId","add_email","userRes","Object","keys","length","alert","onLogin","idToken","catch","error","auth","control","actions","toggle"],"mappings":"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","sourcesContent":["import { useState, useRef, useContext, useEffect } from \"react\";\nimport { useDispatch } from \"react-redux\";\n\nimport classes from \"./AuthForm.module.css\";\nimport AuthContext from \"../../store/AuthContext\";\nimport { ExpencesAction } from \"../../store/expences-slice\";\n\nconst AuthForm = () => {\n  const [isLogin, setIsLogin] = useState(true);\n  const emailRef = useRef();\n  const passwordRef = useRef();\n  const ctx = useContext(AuthContext);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const uid = localStorage.getItem(\"userId\");\n    if (uid) {\n      dispatch(ExpencesAction.addUserId(uid));\n    }\n  }, [dispatch]);\n  const switchAuthModeHandler = () => {\n    setIsLogin((prevState) => !prevState);\n  };\n\n  const onSubmitHandler = (event) => {\n    event.preventDefault();\n    const email = emailRef.current.value;\n    const password = passwordRef.current.value;\n\n    if (email && password) {\n      let url = \"\";\n      if (isLogin) {\n        url =\n          \"https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=AIzaSyDkyHz1CTqvoZKQHlZqcOmhjNwnAzH2HJo\";\n      } else {\n        url =\n          \"https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyDkyHz1CTqvoZKQHlZqcOmhjNwnAzH2HJo\";\n      }\n      fetch(url, {\n        method: \"POST\",\n        body: JSON.stringify({\n          email: email,\n          password: password,\n          returnSecureToken: true,\n        }),\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      })\n        .then((res) => {\n          if (res.ok) {\n            return res.json();\n          } else {\n            throw new Error(\"auth fail\");\n          }\n        })\n        .then(async (user) => {\n          const res = await fetch(\n            `https://expencetracker-b3897-default-rtdb.firebaseio.com/users.json?orderBy=\"email\"&equalTo=\"${email}\"&print=pretty`\n          );\n\n          res.json().then(async (data) => {\n            let userId = \"\";\n\n            const add_email = async () => {\n              const userRes = await fetch(\n                \"https://expencetracker-b3897-default-rtdb.firebaseio.com/users.json\",\n                {\n                  method: \"post\",\n                  body: JSON.stringify({\n                    email: localStorage.getItem(\"email\"),\n                  }),\n                  headers: {\n                    \"Content-Type\": \"Application/Json\",\n                  },\n                }\n              );\n              if (userRes.ok) {\n                return userRes.json().then((user) => {\n                  return user[\"name\"];\n                });\n              } else {\n                throw new Error(\"not able to add email\");\n              }\n            };\n\n            if (Object.keys(data).length === 0) {\n              try {\n                userId = await add_email();\n              } catch (error) {\n                alert(error);\n              }\n            } else {\n              userId = Object.keys(data)[0];\n            }\n            dispatch(ExpencesAction.addUserId(userId));\n            ctx.onLogin(email, user.idToken);\n          });\n        })\n        .catch((error) => {\n          alert(error);\n        });\n    }\n  };\n\n  return (\n    <section className={classes.auth}>\n      <h1>{isLogin ? \"Login\" : \"Sign Up\"}</h1>\n      <form onSubmit={onSubmitHandler}>\n        <div className={classes.control}>\n          <label htmlFor=\"email\">Your Email</label>\n          <input type=\"email\" id=\"email\" ref={emailRef} required />\n          {/* <input type=\"text\" data-nusa-concept-name=\"email\" id=\"email\" ref={emailRef} required /> */}\n        </div>\n        <div className={classes.control}>\n          <label htmlFor=\"password\">Your Password</label>\n          <input type=\"password\" id=\"password\" ref={passwordRef} required />\n          {/* <input type=\"text\" data-nusa-concept-name=\"password\" id=\"password\" ref={passwordRef} required /> */}\n        </div>\n        <div className={classes.actions}>\n          <button>{isLogin ? \"Login\" : \"Create Account\"}</button>\n          <button\n            type=\"button\"\n            className={classes.toggle}\n            onClick={switchAuthModeHandler}\n          >\n            {isLogin ? \"Create new account\" : \"Login with existing account\"}\n          </button>\n        </div>\n      </form>\n    </section>\n  );\n};\n\nexport default AuthForm;\n"]},"metadata":{},"sourceType":"module"}